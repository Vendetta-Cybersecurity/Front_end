<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Dashboard Auditor - Figger Energy SAS">
    <title>Dashboard Auditor - Figger Energy SAS</title>
    
    <!-- Estilos -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="stylesheet" href="../assets/css/dashboard.css">
    <link rel="stylesheet" href="../assets/css/responsive.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/images/favicon.ico">
    <link rel="shortcut icon" href="../assets/images/favicon.ico">
    <link rel="apple-touch-icon" href="../assets/images/logo.png">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="container">
                <div class="dashboard-logo">
                    <img src="../assets/images/logo.png" alt="Figger Energy SAS" class="dashboard-logo-img">
                    <div class="dashboard-logo-text">
                        <h1>Figger Energy SAS</h1>
                        <div class="subtitle">Panel de Auditor√≠a</div>
                    </div>
                </div>
                
                <nav class="dashboard-nav">
                    <button class="sidebar-toggle" style="display: none;">‚ò∞</button>
                    
                    <ul class="nav-links">
                        <li><a href="#resumen" class="active">Resumen</a></li>
                        <li><a href="#empleados">Empleados</a></li>
                        <li><a href="#departamentos">Departamentos</a></li>
                        <li><a href="#reportes">Reportes</a></li>
                    </ul>
                    
                    <div class="user-info">
                        <button class="notification-bell">
                            üîî
                            <span class="notification-badge" style="display: none;">0</span>
                        </button>
                        
                        <div class="user-avatar"></div>
                        
                        <div class="user-details">
                            <div class="user-name"></div>
                            <div class="user-role"></div>
                        </div>
                        
                        <button class="logout-btn">Cerrar Sesi√≥n</button>
                    </div>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <div class="dashboard-wrapper">
            <!-- Sidebar -->
            <aside class="dashboard-sidebar">
                <div class="sidebar-header">
                    <h3 class="sidebar-title">Auditor√≠a</h3>
                </div>
                
                <nav class="sidebar-menu">
                    <div class="menu-section">
                        <h4 class="menu-section-title">Supervisi√≥n</h4>
                        <ul class="menu-items">
                            <li class="menu-item">
                                <a href="#resumen" class="menu-link active">
                                    <span class="menu-icon">üìä</span>
                                    <span>Resumen General</span>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="#metricas" class="menu-link">
                                    <span class="menu-icon">üìà</span>
                                    <span>M√©tricas</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="menu-section">
                        <h4 class="menu-section-title">Datos</h4>
                        <ul class="menu-items">
                            <li class="menu-item">
                                <a href="#empleados" class="menu-link">
                                    <span class="menu-icon">üë•</span>
                                    <span>Empleados</span>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="#departamentos" class="menu-link">
                                    <span class="menu-icon">üè¢</span>
                                    <span>Departamentos</span>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="#roles" class="menu-link">
                                    <span class="menu-icon">üéØ</span>
                                    <span>Roles</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="menu-section">
                        <h4 class="menu-section-title">Reportes</h4>
                        <ul class="menu-items">
                            <li class="menu-item">
                                <a href="#reportes" class="menu-link">
                                    <span class="menu-icon">üìã</span>
                                    <span>Reportes</span>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="#exportar" class="menu-link">
                                    <span class="menu-icon">üì•</span>
                                    <span>Exportar Datos</span>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="#logs" class="menu-link">
                                    <span class="menu-icon">üìú</span>
                                    <span>Logs del Sistema</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main class="dashboard-main">
                <!-- Page Header -->
                <div class="page-header">
                    <h1 class="page-title">Panel de Auditor√≠a</h1>
                    <p class="page-subtitle">Supervisi√≥n y control de calidad del sistema</p>
                    
                    <div class="page-actions">
                        <button class="btn btn-outline-primary refresh-btn">
                            üîÑ Actualizar
                        </button>
                        <button class="btn btn-outline-success export-btn">
                            üì• Exportar Reporte
                        </button>
                        <button class="btn btn-primary generate-report-btn">
                            üìã Generar Reporte
                        </button>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="quick-stats">
                    <div class="quick-stat stat-employees" id="total-employees">
                        <div class="stat-header">
                            <div class="stat-info">
                                <h3>Total Empleados</h3>
                            </div>
                            <div class="stat-icon">üë•</div>
                        </div>
                        <div class="stat-value">0</div>
                        <div class="stat-change neutral">
                            <span>üìä Registros totales</span>
                        </div>
                    </div>
                    
                    <div class="quick-stat stat-active" id="active-employees">
                        <div class="stat-header">
                            <div class="stat-info">
                                <h3>Empleados Activos</h3>
                            </div>
                            <div class="stat-icon">‚úÖ</div>
                        </div>
                        <div class="stat-value">0</div>
                        <div class="stat-change positive">
                            <span>üìà En estado activo</span>
                        </div>
                    </div>
                    
                    <div class="quick-stat stat-departments" id="total-departments">
                        <div class="stat-header">
                            <div class="stat-info">
                                <h3>Departamentos</h3>
                            </div>
                            <div class="stat-icon">üè¢</div>
                        </div>
                        <div class="stat-value">0</div>
                        <div class="stat-change neutral">
                            <span>üèóÔ∏è √Åreas organizacionales</span>
                        </div>
                    </div>
                    
                    <div class="quick-stat stat-compliance">
                        <div class="stat-header">
                            <div class="stat-info">
                                <h3>Cumplimiento</h3>
                            </div>
                            <div class="stat-icon">‚úîÔ∏è</div>
                        </div>
                        <div class="stat-value">100%</div>
                        <div class="stat-change positive">
                            <span>‚úÖ Normativa vigente</span>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Widgets -->
                <div class="dashboard-widgets">
                    <!-- System Overview Widget -->
                    <div class="widget">
                        <div class="widget-header">
                            <h3 class="widget-title">Vista General del Sistema</h3>
                            <div class="widget-actions">
                                <button class="widget-action" title="Actualizar" onclick="location.reload()">üîÑ</button>
                                <button class="widget-action" title="Ver detalles" id="view-details">üëÅÔ∏è</button>
                            </div>
                        </div>
                        <div class="widget-body">
                            <div class="system-overview" id="system-overview">
                                <div class="loading-container">
                                    <div class="loading-spinner"></div>
                                    <div class="loading-text">Cargando vista general...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Audit Trail Widget -->
                    <div class="widget">
                        <div class="widget-header">
                            <h3 class="widget-title">Actividad del Sistema</h3>
                            <div class="widget-actions">
                                <button class="widget-action" title="Ver logs completos" id="view-logs">üìú</button>
                            </div>
                        </div>
                        <div class="widget-body">
                            <div class="audit-trail" id="audit-trail">
                                <div class="activity-list">
                                    <div class="activity-item">
                                        <div class="activity-icon">üîç</div>
                                        <div class="activity-content">
                                            <p class="activity-text">Sistema de auditor√≠a iniciado</p>
                                            <div class="activity-time">Hace unos momentos</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Tables Section -->
                <div class="dashboard-widgets">
                    <!-- Employees Overview -->
                    <div class="widget">
                        <div class="widget-header">
                            <h3 class="widget-title">Empleados (Solo Lectura)</h3>
                            <div class="widget-actions">
                                <button class="widget-action export-btn" title="Exportar datos">üì•</button>
                            </div>
                        </div>
                        <div class="widget-body">
                            <div id="employee-audit-table">
                                <div class="loading-container">
                                    <div class="loading-spinner"></div>
                                    <div class="loading-text">Cargando datos de empleados...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Department Statistics -->
                    <div class="widget">
                        <div class="widget-header">
                            <h3 class="widget-title">Estad√≠sticas por Departamento</h3>
                        </div>
                        <div class="widget-body">
                            <div id="department-statistics">
                                <div class="loading-container">
                                    <div class="loading-spinner"></div>
                                    <div class="loading-text">Cargando estad√≠sticas...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Section -->
                <div class="widget">
                    <div class="widget-header">
                        <h3 class="widget-title">Herramientas de Auditor√≠a</h3>
                    </div>
                    <div class="widget-body">
                        <div class="audit-tools">
                            <div class="tools-grid">
                                <div class="tool-card">
                                    <div class="tool-icon">üìä</div>
                                    <h4>Reporte General</h4>
                                    <p>Vista completa del estado del sistema</p>
                                    <button class="btn btn-outline-primary generate-report-btn">Generar</button>
                                </div>
                                
                                <div class="tool-card">
                                    <div class="tool-icon">üë•</div>
                                    <h4>Reporte de Personal</h4>
                                    <p>An√°lisis detallado de empleados</p>
                                    <button class="btn btn-outline-success" id="employee-report">Generar</button>
                                </div>
                                
                                <div class="tool-card">
                                    <div class="tool-icon">üè¢</div>
                                    <h4>An√°lisis Departamental</h4>
                                    <p>M√©tricas por √°rea organizacional</p>
                                    <button class="btn btn-outline-info" id="department-report">Generar</button>
                                </div>
                                
                                <div class="tool-card">
                                    <div class="tool-icon">üîç</div>
                                    <h4>Log de Actividades</h4>
                                    <p>Historial de acciones del sistema</p>
                                    <button class="btn btn-outline-warning" id="activity-log">Ver Logs</button>
                                </div>
                                
                                <div class="tool-card">
                                    <div class="tool-icon">üì•</div>
                                    <h4>Exportar Datos</h4>
                                    <p>Descargar informaci√≥n en formato CSV</p>
                                    <button class="btn btn-outline-secondary export-btn">Exportar</button>
                                </div>
                                
                                <div class="tool-card">
                                    <div class="tool-icon">‚ö°</div>
                                    <h4>Estado del Sistema</h4>
                                    <p>Verificar conectividad y rendimiento</p>
                                    <button class="btn btn-outline-primary" id="system-status">Verificar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../assets/js/utils.js"></script>
    <script src="../assets/js/api.js"></script>
    <script src="../assets/js/auth.js"></script>
    <script src="../assets/js/components.js"></script>
    <script src="../assets/js/dashboard.js"></script>

    <script>
        // Configuraci√≥n espec√≠fica para dashboard de auditor
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar que sea auditor
            if (!authManager.isAuthenticated() || !authManager.hasRole('auditor')) {
                authManager.logout();
                return;
            }

            console.log('Auditor Dashboard initialized');
            
            // Cargar datos de auditor√≠a
            loadAuditData();
            
            // Configurar eventos espec√≠ficos
            setupAuditorEvents();
            
            // Manejar navegaci√≥n de sidebar
            setupSidebarNavigation();
            
            // Configurar responsive
            setupResponsiveLayout();
            
            // Mostrar mensaje de bienvenida
            showToast('Panel de auditor√≠a cargado correctamente', 'success', 3000);
        });

        async function loadAuditData() {
            try {
                // Cargar estad√≠sticas generales
                const stats = await apiClient.getEstadisticasGenerales();
                updateAuditStats(stats);
                
                // Cargar vista general del sistema
                await loadSystemOverview();
                
                // Cargar datos de empleados (solo lectura)
                await loadEmployeeAuditData();
                
                // Cargar estad√≠sticas departamentales
                await loadDepartmentStatistics();
                
                // Cargar logs de actividad
                loadActivityLogs();
                
            } catch (error) {
                console.error('Error loading audit data:', error);
                showToast('Error al cargar algunos datos de auditor√≠a', 'warning');
            }
        }

        function updateAuditStats(stats) {
            document.getElementById('total-employees').querySelector('.stat-value').textContent = 
                FormatUtils.formatNumber(stats.total_empleados);
            
            document.getElementById('active-employees').querySelector('.stat-value').textContent = 
                FormatUtils.formatNumber(stats.empleados_activos);
            
            document.getElementById('total-departments').querySelector('.stat-value').textContent = 
                FormatUtils.formatNumber(stats.total_departamentos);
        }

        async function loadSystemOverview() {
            const overviewContainer = document.getElementById('system-overview');
            
            try {
                const [stats, departments] = await Promise.all([
                    apiClient.getEstadisticasGenerales(),
                    apiClient.getDepartamentos()
                ]);
                
                overviewContainer.innerHTML = `
                    <div class="overview-grid">
                        <div class="overview-item">
                            <h4>üìä Resumen de Datos</h4>
                            <ul>
                                <li><strong>Total empleados:</strong> ${stats.total_empleados}</li>
                                <li><strong>Empleados activos:</strong> ${stats.empleados_activos}</li>
                                <li><strong>Departamentos:</strong> ${stats.total_departamentos}</li>
                                <li><strong>Roles definidos:</strong> ${stats.total_roles || 'N/A'}</li>
                            </ul>
                        </div>
                        
                        <div class="overview-item">
                            <h4>üè¢ Estado Departamental</h4>
                            <ul>
                                ${departments.map(dept => `
                                    <li><strong>${dept.nombre}:</strong> ${dept.total_empleados || 0} empleados</li>
                                `).join('')}
                            </ul>
                        </div>
                        
                        <div class="overview-item">
                            <h4>‚úÖ Indicadores de Calidad</h4>
                            <ul>
                                <li><strong>Integridad de datos:</strong> ‚úÖ √ìptima</li>
                                <li><strong>Consistencia:</strong> ‚úÖ Verificada</li>
                                <li><strong>Disponibilidad:</strong> ‚úÖ 100%</li>
                                <li><strong>Cumplimiento normativo:</strong> ‚úÖ Conforme</li>
                            </ul>
                        </div>
                        
                        <div class="overview-item">
                            <h4>üîç √öltimas Verificaciones</h4>
                            <ul>
                                <li>Validaci√≥n de estructura: ${new Date().toLocaleDateString('es-CO')}</li>
                                <li>Verificaci√≥n de permisos: ${new Date().toLocaleDateString('es-CO')}</li>
                                <li>Control de acceso: ${new Date().toLocaleDateString('es-CO')}</li>
                            </ul>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading system overview:', error);
                overviewContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--error-color);">
                        ‚ùå Error al cargar la vista general del sistema
                    </div>
                `;
            }
        }

        async function loadEmployeeAuditData() {
            const tableContainer = document.getElementById('employee-audit-table');
            
            try {
                const empleados = await apiClient.getEmpleados();
                
                const columns = [
                    { key: 'numero_documento', title: 'Documento', sortable: true },
                    { key: 'nombre_completo', title: 'Nombre Completo', sortable: true },
                    { key: 'email', title: 'Email', sortable: true },
                    { key: 'departamento_nombre', title: 'Departamento', sortable: true },
                    { key: 'rol_nombre', title: 'Rol', sortable: true },
                    { 
                        key: 'fecha_ingreso', 
                        title: 'Fecha Ingreso', 
                        type: 'date',
                        sortable: true 
                    },
                    { 
                        key: 'estado', 
                        title: 'Estado', 
                        type: 'badge',
                        render: (value) => {
                            const badgeClass = value === 'activo' ? 'success' : 'secondary';
                            return `<span class="badge badge-${badgeClass}">${FormatUtils.capitalize(value)}</span>`;
                        }
                    }
                ];
                
                const dataTable = new DataTable(tableContainer, {
                    data: empleados,
                    columns: columns,
                    actions: [], // Sin acciones para auditor (solo lectura)
                    searchable: true,
                    sortable: true,
                    pageSize: 15,
                    emptyMessage: 'No se encontraron empleados para auditar'
                });
                
            } catch (error) {
                console.error('Error loading employee audit data:', error);
                tableContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--error-color);">
                        ‚ùå Error al cargar datos de empleados para auditor√≠a
                    </div>
                `;
            }
        }

        async function loadDepartmentStatistics() {
            const statsContainer = document.getElementById('department-statistics');
            
            try {
                const [departamentos, estadisticas] = await Promise.all([
                    apiClient.getDepartamentos(),
                    apiClient.getEstadisticasDepartamentos()
                ]);
                
                statsContainer.innerHTML = `
                    <div class="department-stats-grid">
                        ${departamentos.map(dept => `
                            <div class="dept-stat-card">
                                <h4>${dept.nombre}</h4>
                                <div class="stat-item">
                                    <span class="stat-label">Empleados:</span>
                                    <span class="stat-number">${dept.total_empleados || 0}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Estado:</span>
                                    <span class="badge badge-${dept.estado === 'activo' ? 'success' : 'secondary'}">
                                        ${FormatUtils.capitalize(dept.estado)}
                                    </span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Descripci√≥n:</span>
                                    <span class="stat-text">${dept.descripcion || 'Sin descripci√≥n'}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading department statistics:', error);
                statsContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--error-color);">
                        ‚ùå Error al cargar estad√≠sticas departamentales
                    </div>
                `;
            }
        }

        function loadActivityLogs() {
            const auditTrail = document.getElementById('audit-trail');
            
            // Simular logs de actividad (en producci√≥n vendr√≠an del backend)
            const activityLogs = authManager.getActivityLog();
            
            if (activityLogs.length === 0) {
                auditTrail.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--gray-600);">
                        üìú No hay actividad registrada
                    </div>
                `;
                return;
            }
            
            const recentLogs = activityLogs.slice(-10).reverse(); // √öltimos 10
            
            auditTrail.innerHTML = `
                <div class="activity-list">
                    ${recentLogs.map(log => `
                        <div class="activity-item">
                            <div class="activity-icon">
                                ${getActivityIcon(log.action)}
                            </div>
                            <div class="activity-content">
                                <p class="activity-text">
                                    <strong>${log.user}:</strong> ${log.details || log.action}
                                </p>
                                <div class="activity-time">
                                    ${FormatUtils.formatRelativeDate(log.timestamp)}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function getActivityIcon(action) {
            const icons = {
                'login': 'üîë',
                'logout': 'üö™',
                'create': '‚ûï',
                'update': '‚úèÔ∏è',
                'delete': 'üóëÔ∏è',
                'view': 'üëÅÔ∏è',
                'export': 'üì•',
                'login_failed': '‚ö†Ô∏è'
            };
            
            return icons[action] || 'üìã';
        }

        function setupAuditorEvents() {
            // Generar reporte general
            const generateReportBtns = document.querySelectorAll('.generate-report-btn');
            generateReportBtns.forEach(btn => {
                btn.addEventListener('click', generateGeneralReport);
            });
            
            // Exportar datos
            const exportBtns = document.querySelectorAll('.export-btn');
            exportBtns.forEach(btn => {
                btn.addEventListener('click', exportData);
            });
            
            // Reporte de empleados
            const employeeReportBtn = document.getElementById('employee-report');
            if (employeeReportBtn) {
                employeeReportBtn.addEventListener('click', generateEmployeeReport);
            }
            
            // Reporte departamental
            const departmentReportBtn = document.getElementById('department-report');
            if (departmentReportBtn) {
                departmentReportBtn.addEventListener('click', generateDepartmentReport);
            }
            
            // Ver logs
            const activityLogBtn = document.getElementById('activity-log');
            if (activityLogBtn) {
                activityLogBtn.addEventListener('click', viewActivityLogs);
            }
            
            // Estado del sistema
            const systemStatusBtn = document.getElementById('system-status');
            if (systemStatusBtn) {
                systemStatusBtn.addEventListener('click', checkSystemStatus);
            }
            
            // Ver detalles
            const viewDetailsBtn = document.getElementById('view-details');
            if (viewDetailsBtn) {
                viewDetailsBtn.addEventListener('click', viewSystemDetails);
            }
        }

        function generateGeneralReport() {
            const modal = createModal({
                title: 'üìä Reporte General del Sistema',
                size: 'large',
                content: `
                    <div class="report-content">
                        <h4>Resumen Ejecutivo</h4>
                        <p>Este reporte proporciona una vista completa del estado actual del sistema de gesti√≥n de Figger Energy SAS.</p>
                        
                        <h4>üìà M√©tricas Principales</h4>
                        <div class="metrics-summary">
                            <div class="metric-row">
                                <span>Total de empleados:</span>
                                <strong id="report-total-employees">Calculando...</strong>
                            </div>
                            <div class="metric-row">
                                <span>Empleados activos:</span>
                                <strong id="report-active-employees">Calculando...</strong>
                            </div>
                            <div class="metric-row">
                                <span>Departamentos:</span>
                                <strong id="report-departments">Calculando...</strong>
                            </div>
                        </div>
                        
                        <h4>‚úÖ Estado de Cumplimiento</h4>
                        <ul>
                            <li>‚úÖ Cumplimiento Ley 1581 de 2012 (Protecci√≥n de Datos)</li>
                            <li>‚úÖ Integridad de datos verificada</li>
                            <li>‚úÖ Controles de acceso implementados</li>
                            <li>‚úÖ Trazabilidad de auditor√≠a activa</li>
                        </ul>
                        
                        <h4>üìã Recomendaciones</h4>
                        <ul>
                            <li>Mantener respaldos regulares de la informaci√≥n</li>
                            <li>Revisar permisos de usuario trimestralmente</li>
                            <li>Continuar monitoreo de actividades del sistema</li>
                        </ul>
                        
                        <div style="margin-top: 2rem; padding: 1rem; background: var(--gray-100); border-radius: var(--border-radius);">
                            <strong>Fecha del reporte:</strong> ${new Date().toLocaleDateString('es-CO')}<br>
                            <strong>Generado por:</strong> ${authManager.getCurrentUser().fullName}<br>
                            <strong>Rol:</strong> Auditor del Sistema
                        </div>
                    </div>
                `,
                footer: `
                    <button class="btn btn-secondary" onclick="hideModal()">Cerrar</button>
                    <button class="btn btn-primary" onclick="printReport()">üñ®Ô∏è Imprimir</button>
                `
            });
            
            showModal(modal);
            
            // Cargar m√©tricas en el reporte
            loadReportMetrics();
        }

        async function loadReportMetrics() {
            try {
                const stats = await apiClient.getEstadisticasGenerales();
                
                document.getElementById('report-total-employees').textContent = stats.total_empleados;
                document.getElementById('report-active-employees').textContent = stats.empleados_activos;
                document.getElementById('report-departments').textContent = stats.total_departamentos;
            } catch (error) {
                console.error('Error loading report metrics:', error);
            }
        }

        function generateEmployeeReport() {
            showToast('Generando reporte de personal...', 'info');
            setTimeout(() => {
                showToast('üìä Reporte de personal generado (funci√≥n de demostraci√≥n)', 'success');
            }, 2000);
        }

        function generateDepartmentReport() {
            showToast('Generando an√°lisis departamental...', 'info');
            setTimeout(() => {
                showToast('üìä An√°lisis departamental generado (funci√≥n de demostraci√≥n)', 'success');
            }, 2000);
        }

        function exportData() {
            showToast('Preparando exportaci√≥n de datos...', 'info');
            setTimeout(() => {
                showToast('üì• Datos exportados correctamente (funci√≥n de demostraci√≥n)', 'success');
            }, 1500);
        }

        function viewActivityLogs() {
            const logs = authManager.getActivityLog();
            
            const modal = createModal({
                title: 'üìú Log de Actividades del Sistema',
                size: 'large',
                content: `
                    <div class="logs-container">
                        ${logs.length === 0 ? 
                            '<p>No hay actividades registradas.</p>' :
                            `<div class="logs-list">
                                ${logs.reverse().map(log => `
                                    <div class="log-entry">
                                        <div class="log-timestamp">${FormatUtils.formatDate(log.timestamp, 'time')}</div>
                                        <div class="log-user">${log.user}</div>
                                        <div class="log-action">${log.action}</div>
                                        <div class="log-details">${log.details}</div>
                                    </div>
                                `).join('')}
                            </div>`
                        }
                    </div>
                `,
                footer: '<button class="btn btn-primary" onclick="hideModal()">Cerrar</button>'
            });
            
            showModal(modal);
        }

        async function checkSystemStatus() {
            const loadingId = showLoading('Verificando estado del sistema...');
            
            try {
                const status = await apiClient.getStatus();
                hideLoading(loadingId);
                
                showToast('‚úÖ Sistema operativo - Todos los servicios funcionando correctamente', 'success');
                
            } catch (error) {
                hideLoading(loadingId);
                showToast('‚ö†Ô∏è Error de conectividad - Verificar conexi√≥n con el servidor', 'warning');
            }
        }

        function viewSystemDetails() {
            const modal = createModal({
                title: 'üîç Detalles del Sistema',
                content: `
                    <div class="system-details">
                        <h4>Informaci√≥n T√©cnica</h4>
                        <div class="detail-grid">
                            <div><strong>Versi√≥n del Sistema:</strong> 1.0.0</div>
                            <div><strong>Base de Datos:</strong> PostgreSQL</div>
                            <div><strong>Servidor:</strong> ${window.location.origin}</div>
                            <div><strong>Navegador:</strong> ${navigator.userAgent.split(' ')[0]}</div>
                        </div>
                        
                        <h4>Estado de Servicios</h4>
                        <ul>
                            <li>‚úÖ API Backend: Operativo</li>
                            <li>‚úÖ Base de Datos: Conectada</li>
                            <li>‚úÖ Autenticaci√≥n: Funcionando</li>
                            <li>‚úÖ Interfaz Web: Cargada</li>
                        </ul>
                    </div>
                `,
                footer: '<button class="btn btn-primary" onclick="hideModal()">Cerrar</button>'
            });
            
            showModal(modal);
        }

        function setupSidebarNavigation() {
            const menuLinks = document.querySelectorAll('.menu-link');
            menuLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    menuLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    const href = this.getAttribute('href');
                    console.log('Auditor navegando a:', href);
                });
            });
        }

        function setupResponsiveLayout() {
            const sidebarToggle = document.querySelector('.sidebar-toggle');
            const sidebar = document.querySelector('.dashboard-sidebar');
            
            function handleResize() {
                if (window.innerWidth <= 1023) {
                    if (sidebarToggle) sidebarToggle.style.display = 'block';
                } else {
                    if (sidebarToggle) sidebarToggle.style.display = 'none';
                    if (sidebar) sidebar.classList.remove('open');
                }
            }
            
            window.addEventListener('resize', handleResize);
            handleResize();
            
            if (sidebarToggle && sidebar) {
                sidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('open');
                });
            }
        }

        function printReport() {
            window.print();
        }
    </script>

    <style>
        /* Estilos espec√≠ficos para dashboard de auditor */
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
        }

        .overview-item h4 {
            color: var(--primary-color);
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
        }

        .overview-item ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .overview-item li {
            padding: 0.25rem 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .overview-item li:last-child {
            border-bottom: none;
        }

        .department-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .dept-stat-card {
            background: var(--gray-50);
            border-radius: var(--border-radius);
            padding: 1rem;
            border-left: 3px solid var(--accent-color);
        }

        .dept-stat-card h4 {
            margin: 0 0 1rem 0;
            color: var(--primary-color);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-weight: 500;
            color: var(--gray-600);
        }

        .stat-number {
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-text {
            font-size: 0.9rem;
            color: var(--text-color);
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .tool-card {
            background: var(--gray-50);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            text-align: center;
            transition: var(--transition-fast);
        }

        .tool-card:hover {
            background: var(--gray-100);
            transform: translateY(-2px);
        }

        .tool-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .tool-card h4 {
            margin: 0 0 0.5rem 0;
            color: var(--primary-color);
        }

        .tool-card p {
            margin: 0 0 1rem 0;
            color: var(--gray-600);
            font-size: 0.9rem;
        }

        .report-content h4 {
            color: var(--primary-color);
            margin: 1.5rem 0 0.5rem 0;
        }

        .report-content h4:first-child {
            margin-top: 0;
        }

        .metrics-summary {
            background: var(--gray-100);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin: 1rem 0;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--gray-300);
        }

        .metric-row:last-child {
            border-bottom: none;
        }

        .logs-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .log-entry {
            display: grid;
            grid-template-columns: auto auto 1fr auto;
            gap: 1rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--gray-200);
            font-size: 0.9rem;
        }

        .log-timestamp {
            color: var(--gray-600);
            font-size: 0.8rem;
        }

        .log-user {
            font-weight: 500;
            color: var(--primary-color);
        }

        .log-action {
            color: var(--text-color);
        }

        .log-details {
            color: var(--gray-600);
            font-size: 0.8rem;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .detail-grid div {
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--gray-200);
        }
    </style>
</body>
</html>

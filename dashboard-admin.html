<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Dashboard Administrador - Figger Energy SAS">
    <title>Dashboard Administrador - Figger Energy SAS</title>
    
    <!-- Estilos -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/dashboard.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">
    <link rel="shortcut icon" href="assets/images/favicon.ico">
    <link rel="apple-touch-icon" href="assets/images/logo.png">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
                        <div class="container">
                <div class="dashboard-logo">
                    <img src="assets/images/logo.png" alt="Figger Energy SAS" class="dashboard-logo-img">
                    <div class="dashboard-logo-text">
                        <h1>Figger Energy SAS</h1>
                        <div class="subtitle">Panel Administrativo</div>
                    </div>
                </div>
                
                <nav class="dashboard-nav">
                    <button class="sidebar-toggle" style="display: none;">‚ò∞</button>
                    
                    <ul class="nav-links">
                        <li><a href="#dashboard" class="active">Dashboard</a></li>
                        <li><a href="#empleados" data-permission="write">Empleados</a></li>
                        <li><a href="#departamentos" data-permission="manage_departments">Departamentos</a></li>
                        <li><a href="#reportes" data-permission="view_all">Reportes</a></li>
                    </ul>
                    
                    <div class="user-info">
                        <button class="notification-bell">
                            üîî
                            <span class="notification-badge" style="display: none;">0</span>
                        </button>
                        
                        <div class="user-avatar"></div>
                        
                        <div class="user-details">
                            <div class="user-name"></div>
                            <div class="user-role"></div>
                        </div>
                        
                        <button class="logout-btn">Cerrar Sesi√≥n</button>
                    </div>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <div class="dashboard-wrapper">
            <!-- Sidebar -->
            <aside class="dashboard-sidebar">
                <div class="sidebar-header">
                    <h3 class="sidebar-title">Panel de Control</h3>
                </div>
                
                <nav class="sidebar-menu">
                    <div class="menu-section">
                        <h4 class="menu-section-title">Principal</h4>
                        <ul class="menu-items">
                            <li class="menu-item">
                                <a href="#dashboard" class="menu-link active">
                                    <span class="menu-icon">üìä</span>
                                    <span>Dashboard</span>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="#estadisticas" class="menu-link">
                                    <span class="menu-icon">üìà</span>
                                    <span>Estad√≠sticas</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="menu-section">
                        <h4 class="menu-section-title">Gesti√≥n</h4>
                        <ul class="menu-items">
                            <li class="menu-item">
                                <a href="#empleados" class="menu-link" data-permission="write">
                                    <span class="menu-icon">üë•</span>
                                    <span>Empleados</span>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="#departamentos" class="menu-link" data-permission="manage_departments">
                                    <span class="menu-icon">üè¢</span>
                                    <span>Departamentos</span>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="#usuarios" class="menu-link" data-permission="manage_users">
                                    <span class="menu-icon">üîê</span>
                                    <span>Usuarios</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="menu-section">
                        <h4 class="menu-section-title">Informes</h4>
                        <ul class="menu-items">
                            <li class="menu-item">
                                <a href="#reportes" class="menu-link" data-permission="view_all">
                                    <span class="menu-icon">üìã</span>
                                    <span>Reportes</span>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="#auditoria" class="menu-link" data-permission="view_all">
                                    <span class="menu-icon">üîç</span>
                                    <span>Auditor√≠a</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main class="dashboard-main">
                <!-- Page Header -->
                <div class="page-header">
                    <h1 class="page-title">Dashboard Administrativo</h1>
                    <p class="page-subtitle">Panel de control y gesti√≥n del sistema</p>
                    
                    <div class="page-actions">
                        <button class="btn btn-outline-primary refresh-btn">
                            üîÑ Actualizar
                        </button>
                        <button class="btn btn-primary add-employee-btn" data-permission="write">
                            ‚ûï Nuevo Empleado
                        </button>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="quick-stats">
                    <div class="quick-stat stat-employees" id="total-employees">
                        <div class="stat-header">
                            <div class="stat-info">
                                <h3>Total Empleados</h3>
                            </div>
                            <div class="stat-icon">üë•</div>
                        </div>
                        <div class="stat-value">0</div>
                        <div class="stat-change neutral">
                            <span>üìä Todos los empleados</span>
                        </div>
                    </div>
                    
                    <div class="quick-stat stat-active" id="active-employees">
                        <div class="stat-header">
                            <div class="stat-info">
                                <h3>Empleados Activos</h3>
                            </div>
                            <div class="stat-icon">‚úÖ</div>
                        </div>
                        <div class="stat-value">0</div>
                        <div class="stat-change positive">
                            <span>üìà En servicio activo</span>
                        </div>
                    </div>
                    
                    <div class="quick-stat stat-departments" id="total-departments">
                        <div class="stat-header">
                            <div class="stat-info">
                                <h3>Departamentos</h3>
                            </div>
                            <div class="stat-icon">üè¢</div>
                        </div>
                        <div class="stat-value">0</div>
                        <div class="stat-change neutral">
                            <span>üèóÔ∏è √Åreas operativas</span>
                        </div>
                    </div>
                    
                    <div class="quick-stat stat-notifications" id="total-notifications">
                        <div class="stat-header">
                            <div class="stat-info">
                                <h3>Notificaciones</h3>
                            </div>
                            <div class="stat-icon">üîî</div>
                        </div>
                        <div class="stat-value">0</div>
                        <div class="stat-change warning">
                            <span>‚ö†Ô∏è Sin leer</span>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Widgets -->
                <div class="dashboard-widgets">
                    <!-- Employee Management Widget -->
                    <div class="widget">
                        <div class="widget-header">
                            <h3 class="widget-title">Gesti√≥n de Empleados</h3>
                            <div class="widget-actions">
                                <button class="widget-action" title="Actualizar" onclick="location.reload()">üîÑ</button>
                                <button class="widget-action add-employee-btn" title="Agregar Empleado" data-permission="write">‚ûï</button>
                            </div>
                        </div>
                        <div class="widget-body">
                            <div id="employee-table-container">
                                <div class="loading-container">
                                    <div class="loading-spinner"></div>
                                    <div class="loading-text">Cargando empleados...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Activity & Notifications Widget -->
                    <div class="widget">
                        <div class="widget-header">
                            <h3 class="widget-title">Actividad Reciente</h3>
                            <div class="widget-actions">
                                <button class="widget-action" title="Ver todas">üëÅÔ∏è</button>
                            </div>
                        </div>
                        <div class="widget-body">
                            <div class="notification-panel">
                                <ul class="notification-list" id="notification-list">
                                    <li class="notification-item">
                                        <div class="notification-content">
                                            <p class="notification-text">Cargando notificaciones...</p>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Additional Sections -->
                <div class="dashboard-widgets">
                    <!-- Chart Section -->
                    <div class="widget">
                        <div class="widget-header">
                            <h3 class="widget-title">Distribuci√≥n por Departamentos</h3>
                            <div class="widget-actions">
                                <button class="widget-action" title="Exportar">üìä</button>
                            </div>
                        </div>
                        <div class="widget-body">
                            <div class="chart-container" id="department-chart">
                                <div style="text-align: center; padding: 3rem; color: var(--gray-600);">
                                    üìä Gr√°fico de distribuci√≥n<br>
                                    <small>Se mostrar√° cuando haya datos disponibles</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="widget">
                        <div class="widget-header">
                            <h3 class="widget-title">Acciones R√°pidas</h3>
                        </div>
                        <div class="widget-body">
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <button class="btn btn-outline-primary add-employee-btn" data-permission="write">
                                    üë§ Agregar Empleado
                                </button>
                                <button class="btn btn-outline-secondary" onclick="window.open('dashboard-empleado.html', '_blank')">
                                    üëÅÔ∏è Vista Empleado
                                </button>
                                <button class="btn btn-outline-success" onclick="window.open('dashboard-auditor.html', '_blank')">
                                    üîç Vista Auditor
                                </button>
                                <button class="btn btn-outline-warning refresh-btn">
                                    üîÑ Actualizar Datos
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/api.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/components.js"></script>
    <script src="assets/js/dashboard.js"></script>

    <script>
        // Configuraci√≥n espec√≠fica para dashboard de admin
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar que sea administrador
            if (!authManager.isAuthenticated() || !authManager.hasRole('admin')) {
                authManager.logout();
                return;
            }

            // Configuraci√≥n espec√≠fica del admin dashboard
            console.log('Admin Dashboard initialized');
            
            // Manejar navegaci√≥n de sidebar
            const menuLinks = document.querySelectorAll('.menu-link');
            menuLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remover active de todos los links
                    menuLinks.forEach(l => l.classList.remove('active'));
                    
                    // Agregar active al link clickeado
                    this.classList.add('active');
                    
                    // Aqu√≠ se pueden agregar acciones espec√≠ficas para cada secci√≥n
                    const href = this.getAttribute('href');
                    console.log('Navegando a:', href);
                });
            });

            // Manejar responsive sidebar
            const sidebarToggle = document.querySelector('.sidebar-toggle');
            const sidebar = document.querySelector('.dashboard-sidebar');
            
            if (sidebarToggle && sidebar) {
                sidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('open');
                });
                
                // Cerrar sidebar al hacer click fuera en m√≥viles
                document.addEventListener('click', function(e) {
                    if (window.innerWidth <= 1023 && 
                        !sidebar.contains(e.target) && 
                        !sidebarToggle.contains(e.target)) {
                        sidebar.classList.remove('open');
                    }
                });
            }

            // Funci√≥n para detectar cambios de tama√±o de ventana
            function handleResize() {
                const sidebarToggle = document.querySelector('.sidebar-toggle');
                
                if (window.innerWidth <= 1023) {
                    if (sidebarToggle) sidebarToggle.style.display = 'block';
                } else {
                    if (sidebarToggle) sidebarToggle.style.display = 'none';
                    if (sidebar) sidebar.classList.remove('open');
                }
            }

            // Configurar resize listener
            window.addEventListener('resize', handleResize);
            handleResize(); // Ejecutar una vez al cargar

            // Manejar teclas de acceso r√°pido
            document.addEventListener('keydown', function(e) {
                // Ctrl + N para nuevo empleado
                if (e.ctrlKey && e.key === 'n' && authManager.hasPermission('write')) {
                    e.preventDefault();
                    const addBtn = document.querySelector('.add-employee-btn');
                    if (addBtn) addBtn.click();
                }
                
                // Ctrl + R para refresh (sobrescribir el del navegador)
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    const refreshBtn = document.querySelector('.refresh-btn');
                    if (refreshBtn) refreshBtn.click();
                }
            });

            // Mostrar informaci√≥n de sesi√≥n en desarrollo
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                console.log('Usuario actual:', authManager.getCurrentUser());
                console.log('Permisos:', authManager.getCurrentUser()?.permissions);
            }
        });

        // Manejar errores de conexi√≥n con el backend
        window.addEventListener('online', function() {
            showToast('Conexi√≥n restaurada', 'success');
            if (window.dashboardManager) {
                window.dashboardManager.refreshData();
            }
        });

        window.addEventListener('offline', function() {
            showToast('Sin conexi√≥n a internet', 'warning', 0);
        });
    </script>
</body>
</html>
